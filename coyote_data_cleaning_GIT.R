## Coyote Survey ##

# dependent variables of interest
# 1) value
# 2) interactions
#  a. sighting
#  b. incidents


# Clean Up ---------------------------------------------------------------------
rm(list=ls())
gc() #garbage collection

# Libraries---------------------------------------------------------------------
library(tidyverse) # data manipulation (includes ggplot and forcats)
library(lubridate) # dates 
library(dplyr)
library(psych)
library(janitor)
library(corrr)
# Read in data----------------------------------------------------------------

setwd("C:/Users/Kim Rivera/Documents/URI/Coyotes/Final_GIT")
coyote_raw = read_csv("coyote_data_GIT.csv") # survey data

# Convert all characters to factor for simplicity, can change back to numeric, etc later if needed
coyote = coyote_raw %>% mutate_if(sapply(coyote_raw, is.character), as.factor)

# create new column which ID's unusable data, 0 = good data, 1's = unusable/ flagged 
# start with survey.type and flag 'Survey Preview' and 'Spam'
coyote = coyote %>% mutate(flagged = ifelse(response.type == "Spam", 1,
                                            ifelse(response.type == "Survey Preview", 1, 0)))
coyote = filter(coyote, flagged != 1)
# Participant Demographics------------------------------------------------------

## Age -------------------------------------------------------------------------
## Check Out Distribution
ggplot(coyote, aes(x=age)) +
  geom_histogram()

# Hmm, I believe it is unlikely a participant is over 110 y/o. Either this was entered wrong or perhaps the participant doesn't want 
# to share their age or did not take this survey seriously. Let's look at the data point and investigate other responses
# I'm going to be using exam as a place holder for data I am examining

# We will therefor change age unrealistic ages to NA
coyote <- coyote %>% mutate(age = na_if(age, 120))

## Gender-----------------------------------------------------------------------
levels(coyote$gender)

# Let's convert unusable entries to NA
coyote <- coyote %>% mutate(gender = recode_factor(gender, "Apache attack helicopter" = NA_character_)) %>% 
  mutate(gender = recode_factor(gender, "mmm, no." = NA_character_)) %>% 
  mutate(gender = recode_factor(gender, "I don't believe in gender" = NA_character_)) %>%
  mutate(gender = recode_factor(gender, "Bi curious Buffalo." = NA_character_))

## collapse and correct level labels
coyote <- coyote %>% mutate(gender = fct_collapse(gender, 
                                                  male = c("m", "M", "Male", "boy", "MALE","Make", "Dude","cisgender male",
                                                                   "male.  However it is interesting that the previous question offered selections but this question did not.",
                                                                   "Man", "masculine", "male"),
                                                  female = c("Femail", "More or less female", "femal", "woman", "Woman", "F", "f", "Female", "female", "is that still a thing? female"),
                                                  non.binary = c("Female, non-binary/fluid" ,"non binary", "Genderqueer/Nonbinary", "Non-Binary","Non-binary","non-binary")))
levels(coyote$gender)

## Check Out Distribution
ggplot(coyote, aes(x= gender)) +
  geom_bar()


## Education--------------------------------------------------------------------
levels(coyote$education)
coyote <- coyote %>% mutate(education = factor(education)) %>%
  mutate(education = fct_relevel(education, c("Elementary School", "Middle School","High School",  "Technical or vocational degree", "2-year college degree or certificate", "4-year college Degree", "Graduate Degree")))

ggplot(coyote, aes(education, fill = education)) +
  geom_bar() +
  labs(x = "Education", y = "Counts", title = "Level of Education in RI") + 
  theme_minimal() +
  theme(legend.position="none",
        axis.text.x = element_text(angle = 45, hjust = 1),
        text = element_text(family = "LM Roman 10 Bold", size=15)) 

## Household Income-------------------------------------------------------------
# Turn into factor
coyote <- coyote %>% mutate(household.income= factor(household.income))

## Organize levels
coyote <- coyote %>% mutate(household.income = factor(household.income)) %>%
  mutate(household.income = fct_relevel(household.income, c("Under $15,000", "Between $15,000 and $29,999","Between $30,000 and $49,999",
                                                            "Between $50,000 and $74,999","Between $75,000 and $99,999","Between $100,000 and $149,999","Between $150,000 and $199,999", "$200,000 or more" )))

ggplot(coyote, aes(household.income, fill = household.income)) +
  geom_bar() +
  labs(x = "Household Income", y = "Counts", title = "Household Income RI") + 
  theme_minimal() +
  theme(legend.position="none",
        axis.text.x = element_text(angle = 45, hjust = 1),
        text = element_text(family = "LM Roman 10 Bold", size=15)) 

## Ethnic Group-----------------------------------------------------------------
levels(factor(coyote$ethnicity))
ggplot(coyote, aes(x=ethnicity)) +
  geom_bar()

coyote <- coyote %>% 
  mutate(ethnicity.african.american = ifelse(str_detect(ethnicity,"African American"),1,0),
         ethnicity.asian = ifelse(str_detect(ethnicity,"Asian"),1,0),
         ethnicity.white = ifelse(str_detect(ethnicity,"White/ Caucasian"),1,0),
         ethnicity.native.american = ifelse(str_detect(ethnicity,"Native American"),1,0),
         ethnicity.islander = ifelse(str_detect(ethnicity,"Hawaiian or Pacific Islander"),1,0),
         ethnicity.hispanic = ifelse(str_detect(ethnicity,"Hispanic"),1,0))

levels(factor(coyote$ethnicity.text))
coyote <- coyote %>% mutate(ethnicity.text = recode_factor(ethnicity.text, "why does it matter?" = NA_character_)) %>% 
  mutate(ethnicity.text = recode_factor(ethnicity.text, "Local" = NA_character_)) %>% 
  mutate(ethnicity.text = recode_factor(ethnicity.text, "Human race" = NA_character_)) %>% 
  mutate(ethnicity.text = recode_factor(ethnicity.text, "American" = NA_character_))

#(?i) = ignore CASE 
coyote <- coyote %>% 
  mutate(ethnicity.black = ifelse(str_detect(ethnicity.text,"I'm not African American I'm just Black"),1,0),
         ethnicity.jewish = ifelse(str_detect(ethnicity.text, "(?i)jewish"),1,0),
         ethnicity.middle.eastern = ifelse(str_detect(ethnicity.text,"(?i)middle eastern"),1,0),
         ethnicity.hispanic = replace(ethnicity.hispanic,str_detect(ethnicity.text, "(?i)latino"),1),
         ethnicity.asian = replace(ethnicity.asian,str_detect(ethnicity.text, "South Asian Indian"),1),
         ethnicity.white = replace(ethnicity.white,str_detect(ethnicity.text, "(?i)white|caucasian|Italian|irish|french" ),1))

sum(coyote$ethnicity.white, na.rm = TRUE) 

# Drop the old longer columns, we now have wider columns
coyote = coyote %>% 
  select(-c(ethnicity,ethnicity.text))

## Length of stay in RI for non-residents---------------------------------------

#convert factor to string then to a numeric once everything is a number
class(coyote$months.RI.text)

levels(coyote$months.RI.text)
exam = coyote %>% filter(months.RI.text == "zero")
exam = coyote %>% filter(months.RI.text == 0)
exam = coyote %>% filter(ID == "R_Rlf2IvahxBnmqBP")

coyote <- coyote %>% 
  mutate(flagged = case_when(months.RI.text == "0" ~ 1,
                                months.RI.text == "zero" ~ 1,
                             TRUE ~ as.numeric(flagged))) 

# filter out flagged data again
coyote = filter(coyote, flagged != 1)

# since we already converted to a factor, we need to do this to make numbers numerical 
coyote <- coyote %>% 
  mutate(months.RI.text = as.character(months.RI.text)) 

coyote <- coyote %>% 
  mutate(months.RI = case_when(months.RI.text == "7 (from last year)" ~ 7,
                               months.RI.text == "About 7 months a year" ~ 28, #This was a 4 year student that lives in Mass otherwise
                               months.RI.text == "I went to college at URI and we vacation several weeks per year." ~ 29, 
                               months.RI.text == "All my life until Nov. 2019" ~ age*12-3,
                               months.RI.text %in% c("6 months each year", "Several", "Twice a week", "I live on the edge of RI and work in East Providence.", "I just visit RI occasionally") ~ NA_real_,
                               as.numeric(months.RI.text) >=2000 ~ (2020-as.numeric(months.RI.text))*12+10,
                               str_detect(months.RI.text, "year") ~ as.numeric(str_extract(months.RI.text,"(\\d)+"))*12,
                               TRUE ~ as.numeric(months.RI.text))) %>% 
                                select(-months.RI.text)

# Now that everything is a proper month, we can convert to a numeric value
coyote <- coyote %>% 
  mutate(months.RI = as.numeric(months.RI))

coyote %>% 
  ggplot(aes(x = months.RI)) + 
  geom_histogram(color="darkblue", fill="lightblue") +
  labs(title="Months in RI",x="Months", y="Counts")+
  theme_minimal() + 
  theme(legend.position="none",
        text = element_text(family = "LM Roman 10 Bold", size=15)) 

## Participant Location---------------------------------------------------------

# Residency
coyote %>% 
  ggplot(aes(x = resident, fill = resident)) + 
  geom_bar() + 
  labs(x = "Residency", y = "Counts", title = "Counts of residents vs. non-residents") + 
  theme_minimal() + 
  theme(legend.position="none",
        text = element_text(family = "LM Roman 10 Bold", size=15)) 

## Years of Residency (if resident)---------------------------------------------
summary(coyote$years.residency)

coyote %>% 
  ggplot(aes(x = years.residency)) + 
  geom_histogram(color="darkblue", fill="lightblue") +
  labs(title="Years of residency",x="Years", y="Counts")+
  theme_minimal() + 
  theme(legend.position="none",
        text = element_text(family = "LM Roman 10 Bold", size=15))

## Non-residents----------------------------------------------------------------
levels(factor(coyote$not.resident))
levels(factor(coyote$not.resident.others))

# Let's treat peoples RI activities as we did ethnicity, people may fall into various columns which
# we will turn into wider data
coyote <- coyote %>% 
  mutate(not.resident.student = ifelse(str_detect(not.resident,"I am a student in RI"),1,0),
         not.resident.rent = ifelse(str_detect(not.resident,"I rent a home in RI"),1,0),
         not.resident.work = ifelse(str_detect(not.resident,"I work in RI"),1,0),
         not.resident.vacation = ifelse(str_detect(not.resident,"I own a vacation home or property in RI"),1,0),
         not.resident.tourist = ifelse(str_detect(not.resident,"I am a tourist in RI"),1,0))

# Now let's recode the other column 'others' to fit in the above columns or new columns
coyote <- coyote %>% 
  mutate(not.resident.family = ifelse(str_detect(not.resident.others,"(?i)family|My in-laws in in RI and I'm there almost every weekend"),1,0),
         not.resident.prev.resident = ifelse(str_detect(not.resident.others, "(?i)Grew up|Owned 3 properties|Recently moved|I am a resident currently living in Mexico|I live in de, taking online classes|I once resided for three years in Pawtucket"),1,0),
         not.resident.work = replace(not.resident.work,str_detect(not.resident.others, "(?i)held jobs in RI in the past|worked"),1),
         not.resident.prev.student = ifelse(str_detect(not.resident.others,"previous student"),1,0))

coyote <- coyote %>% 
  mutate(not.resident.family = ifelse(str_detect(not.resident.others,"(?i)family"),1,0),
         not.resident.prev.resident = ifelse(str_detect(not.resident.others, "(?i)Owned 3 properties|Recently moved|I am a resident currently living in Mexico|I live in de, taking online classes|I once resided for three years in Pawtucket"),1,0),
         not.resident.work = replace(not.resident.work,str_detect(not.resident.others, "(?i)held jobs in RI in the past|worked"),1),
         not.resident.family = replace(not.resident.family,str_detect(not.resident.others, "\\bMy in-laws in in RI and I'm there almost every weekend\\b"),1),
         not.resident.prev.resident = replace(not.resident.prev.resident,str_detect(not.resident.others, "\\bGrew up here\\b"),1),
         not.resident.prev.resident = replace(not.resident.prev.resident,str_detect(not.resident.others, "\\bgrew up there"),1),
         not.resident.prev.resident = replace(not.resident.prev.resident,str_detect(not.resident.others, "\\bI grew up in R"),1),
         not.resident.prev.student = ifelse(str_detect(not.resident.others,"previous student"),1,0))

exam = coyote %>% select(not.resident, not.resident.others,not.resident.family, not.resident.prev.student, not.resident.prev.resident, not.resident.work,not.resident.student,not.resident.rent, not.resident.vacation, not.resident.tourist)
                         
# Flag participants that have not spent a significant amount of time in RI
coyote <- coyote %>% 
  mutate(flagged = case_when(not.resident.others == "Living at Home in MA" ~ 1,
                             TRUE ~ as.numeric(flagged)))

# filter out flagged data again
coyote = filter(coyote, flagged != 1)

coyote = coyote %>% 
  select(-c(not.resident.others))

coyote %>% 
  drop_na(not.resident) %>% 
  ggplot(aes(x = not.resident, fill = not.resident)) + 
  geom_bar() + 
  labs(x = "Reason", y = "Counts", title = "Counts per non-residency reason") + 
  theme_minimal() + 
  theme(legend.position="none",
        axis.text.x = element_text(angle = 45, hjust = 1),
        text = element_text(family = "LM Roman 10 Bold", size=15))

## County-----------------------------------------------------------------------
levels(factor(coyote$county))
                             
coyote <- coyote %>% mutate(county = case_when(county == "I do not wish to share this information" ~ "Not_shared",
                                               TRUE ~ as.character(county))) #remember when you use case when, other goes to NA unless stated otherwise


# get the levels ordered by counts 
levels <- coyote %>% 
  group_by(county) %>% 
  summarize(count=n()) %>% 
  arrange(count) %>% 
  select(county) %>% 
  as_vector()

coyote %>% 
  mutate(county = factor(county, levels = levels)) %>% 
  ggplot(aes(x = county, fill = county)) + 
  geom_bar() + 
  labs(x = "County", y = "Counts", title = "Counts per county") + 
  theme_minimal() + 
  theme(legend.position="none",
        axis.text.x = element_text(angle = 45, hjust = 1),
        text = element_text(family = "LM Roman 10 Bold", size=15)) 

## Town-------------------------------------------------------------------------

levels(factor(coyote$town.text))

# Change the mispelling for the towns/villages 
coyote <- coyote %>% 
  mutate(town.text = str_to_title(town.text)) %>% 
  mutate(town.text = case_when(town.text == "Edgewood Cranston" ~ "Cranston",
                               town.text %in% c("Elmhurst","Elmhurst Providence","Hope", "Providence (Hope)","Olneyville (Providence)","Onyville","Summit") ~ "Providence",
                               town.text == "N Smithfield" ~ "North Smithfield",
                               town.text %in% c("Naragansett","Narragansett, But Moving To Coventry") ~ "Narragansett",
                               town.text == "Newp" ~ "Newport",
                               town.text == "No Kingstown" ~ "North Kingstown",
                               town.text %in% c("South Kingston","Kingston Fortin Rd","Kingston") ~ "South Kingstown",
                               town.text == "Scituare" ~ "Scituate",
                               town.text == "Tiverron" ~ "Tiverton",
                               TRUE ~ as.character(town.text)))

levels <- coyote %>% 
  group_by(town.text) %>% 
  summarize(count=n()) %>% 
  arrange(count) %>% 
  select(town.text) %>% 
  as_vector()

coyote %>% 
  mutate(town.text = factor(town.text, levels = levels)) %>% 
  ggplot(aes(x = town.text, fill = town.text)) + 
  geom_bar() + 
  labs(x = "Town and villages", y = "Counts", title = "Counts per town and villages") + 
  theme_minimal() + 
  theme(legend.position="none",
        axis.text.x = element_text(angle = 45, hjust = 1),
        text = element_text(family = "LM Roman 10 Bold", size=5)) 

# combine by town 
coyote <- coyote %>% 
  mutate(town.text = case_when(town.text == "Arnold Mills" ~ "Cumberland",
                               town.text %in% c("Escoheag", "Exeter, West Kingston Area") ~ "Exeter",
                               town.text %in% c("Coventry-Western","Greene") ~ "Coventry",
                               town.text == "Greenville" ~ "Smithfield",
                               town.text %in% c("Harmony/Glocester","Chepachet") ~ "Glocester",
                               town.text == "Hog Island From April Through October" ~ "Portsmouth",
                               town.text %in% c("Hope Valley", "Burdickville In Hopkinton") ~ "Hopkinton",
                               town.text == "Jamestown /Clarkes Village" ~ "Jamestown",
                               town.text %in% c("No Kingstown","Nk","North Kingstown/Wickford", "North Kingstown/Hamilton","Wickford","Saunderstown") ~ "North Kingstown",
                               town.text %in% c("North Scituate","Scituate/Hope") ~ "Scituate",
                               town.text %in% c("Pascoag", "Burrillville / Glendale") ~ "Burrillville",
                               town.text %in% c("Pawtuxet Village","Warwick / Pilgrim Park","Warwick /Greenwood","Warwick...Pojac Area","Gaspee Point", "Warwick - Budlong Farm") ~ "Warwick",
                               town.text %in% c("Peace Dale, South Kingstown","South Kingstown/Peace Dale","Green Hill","Green Hill, Wakefield","South Kingston","Matunuck","South Kingstown/Matunuck","Wakefield","Kingston Fortin Rd","West Kingston","Wordens Pond","East Matunuck","Kingston", "Perryville", "South Kingstown/Kingston", "South Kingstown/Wakefield") ~ "South Kingstown",
                               town.text %in% c("Carolina","Richmond/Carolina","Wyoming") ~ "Richmond",
                               town.text == "Scituate/ Clayville" ~ "Foster",
                               town.text == "Manville" ~ "Lincoln",
                               town.text == "Misquamicut" ~ "Westerly",
                               town.text %in% c("Riverside","Rumford") ~ "East Providence",
                               TRUE ~ as.character(town.text))) %>% 
  select(-town)

view = coyote %>% select(town.text, town)

levels <- coyote %>% 
  group_by(town.text) %>% 
  summarize(count=n()) %>% 
  arrange(count) %>% 
  select(town.text) %>% 
  as_vector()

coyote %>% 
  mutate(town.text = factor(town.text, levels = levels)) %>% 
  ggplot(aes(x = town.text, fill = town.text)) + 
  geom_bar() + 
  labs(x = "Town and villages", y = "Counts", title = "Counts per town") + 
  theme_minimal() + 
  theme(legend.position="none",
        axis.text.x = element_text(angle = 45, hjust = 1),
        text = element_text(family = "LM Roman 10 Bold", size=10)) 

# Relationship with the Outdoors------------------------------------------------
levels(factor(coyote$outdoor))

coyote <- coyote %>% 
  mutate(outdoor.backpacking = ifelse(str_detect(outdoor,"Backpacking"),1,0),
         outdoor.car.rvcamping = ifelse(str_detect(outdoor,"Car or RV camping"),1,0),
         outdoor.fish = ifelse(str_detect(outdoor,"Fishing"),1,0),
         outdoor.hunt = ifelse(str_detect(outdoor,"Hunting or Trapping"),1,0),
         outdoor.other = ifelse(str_detect(outdoor,"Other"),1,0),
         outdoor.mountainbiking = ifelse(str_detect(outdoor,"Mountain biking"),1,0),
         outdoor.road_run.jog = ifelse(str_detect(outdoor,"Road running or jogging"),1,0),
         outdoor.water_sports = ifelse(str_detect(outdoor,"Water"),1,0),
         outdoor.wildlife_viewing = ifelse(str_detect(outdoor,"Wildlife viewing"),1,0),
         outdoor.roadbiking = ifelse(str_detect(outdoor,"Road biking"),1,0),
         outdoor.hike.trailrun = ifelse(str_detect(outdoor,"Hiking or trail running"),1,0),
         outdoor.horseriding = ifelse(str_detect(outdoor,"Horseback riding"),1,0))

coyote %>% 
  pivot_longer(outdoor.backpacking:outdoor.horseriding, names_to="index",values_to="value") %>% 
  filter(value == 1) %>% 
  ggplot(aes(x = index, fill = index)) + 
  geom_bar() + 
  labs(x = "Outdoor activities", y = "Counts", title = "Practicants of outdoor activities") + 
  theme_minimal() + 
  theme(legend.position="none",
        axis.text.x = element_text(angle = 45, hjust = 1),
        text = element_text(family = "LM Roman 10 Bold", size=15)) 

levels(factor(coyote$outdoor.text))

coyote <- coyote %>% 
  mutate(outdoor.walk = ifelse(str_detect(outdoor.text,"wal"),1,0),
         outdoor.sport = ifelse(str_detect(outdoor.text, "(?i)basketball|golf|climb|sport|tennis"),1,0),
         outdoor.water_sports = replace(outdoor.water_sports,str_detect(outdoor.text,"(?i)beach|boat|swim|canoe|sail|kayak|scuba"),1),
         outdoor.snow_sports = ifelse(str_detect(outdoor.text, "(?i)snow|ski"),1,0),
         outdoor.gardening_yard = ifelse(str_detect(outdoor.text,"(?i)garden|yeard|yard"),1,0),
         outdoor.farm = ifelse(str_detect(outdoor.text,"(?i)farm"),1,0),
         outdoor.bike = ifelse(str_detect(outdoor.text,"(?i)bike"),1,0),
         outdoor.monitoring = ifelse(str_detect(outdoor.text,"(?i)sampl|camera|monitor"),1,0),
         outdoor.wildlife_viewing = replace(outdoor.wildlife_viewing,str_detect(outdoor.text,"(?i)bird|geese"),1),
         outdoor.children = ifelse(str_detect(outdoor.text,"(?i)child"),1,0),
         outdoor.foraging = ifelse(str_detect(outdoor.text,"(?i)forag|mushroom"),1,0),
         outdoor.photo_film = ifelse(str_detect(outdoor.text,"(?i)photo|film"),1,0)) %>%
  select(-outdoor.text)

levels <- coyote %>% 
  pivot_longer(outdoor.backpacking:outdoor.photo_film, names_to="index",values_to="value") %>% 
  filter(value == 1) %>% 
  group_by(index) %>% 
  summarize(count=n()) %>% 
  arrange(count) %>% 
  select(index) %>% 
  as_vector()

coyote %>% 
  pivot_longer(outdoor.backpacking:outdoor.photo_film, names_to="index",values_to="value") %>% 
  mutate(index = factor(index, levels = levels)) %>% 
  filter(value == 1) %>% 
  ggplot(aes(x = index, fill = index)) + 
  geom_bar() + 
  labs(x = "Outdoor activities", y = "Counts", title = "Practicants of outdoor activities") + 
  theme_minimal() + 
  theme(legend.position="none",
        axis.text.x = element_text(angle = 45, hjust = 1),
        text = element_text(family = "LM Roman 10 Bold", size=15)) 

# Relationship with nature------------------------------------------------------
# Circles are coded so that the increasing number is a higher relationships ship with nature
# e.g. 1 = lowest, 6 = closest relationship
coyote = coyote %>% mutate(image.relation.nature= factor(image.relation.nature))
view = coyote %>% select(image.relation.nature)
levels(coyote$image.relation.nature)

nature.person = coyote %>% select(nature.person) %>%
  mutate_all(~case_when(
    . == "Yes" ~ 1,
    . == "No" ~ 0))

coyote %>% 
  ggplot(aes(x = nature.person, fill = image.relation.nature)) + 
  geom_bar() 


# New Ecological Paradigm results-----------------------------------------------
# Increasing environmental value goes from strongly disagree [1] -> strongly agree [5]
# Some are reverse coded based on which way value moves e.g. strongly agree [1] -> strongly disagree [5]
levels(coyote$take.care)
class(coyote$take.care)

coyote <- coyote %>% 
  mutate(take.care = fct_relevel(take.care, c("Strongly disagree", "Neither agree nor disagree",  "Agree", "Strongly agree")))
coyote <- coyote  %>%
  mutate(not.to.worry = fct_relevel(not.to.worry, c("Strongly agree", "Agree", "Neither agree nor disagree", "Disagree", "Strongly disagree")))
coyote <- coyote  %>%
  mutate(human.ingenuity = fct_relevel(human.ingenuity, c("Strongly agree", "Agree", "Neither agree nor disagree", "Disagree", "Strongly disagree")))
coyote <- coyote  %>%
  mutate(plenty.resources = fct_relevel(plenty.resources, c("Strongly agree", "Agree", "Neither agree nor disagree", "Disagree", "Strongly disagree")))
coyote <- coyote  %>%
  mutate(equal.rights = fct_relevel(equal.rights, c("Strongly disagree", "Disagree", "Neither agree nor disagree",  "Agree", "Strongly agree")))
coyote <- coyote  %>%
  mutate(laws.of.nature = fct_relevel(laws.of.nature, c("Strongly disagree", "Disagree", "Neither agree nor disagree",  "Agree", "Strongly agree")))
coyote <- coyote  %>%
  mutate(humans.rule = fct_relevel(humans.rule, c("Strongly agree", "Agree", "Neither agree nor disagree", "Disagree", "Strongly disagree")))
coyote <- coyote  %>%
  mutate(delicate.balance = fct_relevel(delicate.balance, c("Strongly disagree", "Disagree", "Neither agree nor disagree",  "Agree", "Strongly agree")))
coyote <- coyote  %>%
  mutate(envt.cata = fct_relevel(envt.cata, c("Strongly disagree", "Disagree", "Neither agree nor disagree",  "Agree", "Strongly agree")))


# Pet Demographics--------------------------------------------------------------
## Lets check out population of pet owners
ggplot(coyote, aes(x = pet.owner, color = pet)) +
  geom_bar(fill="white")

## correct non-informative levels to NAs
coyote <- coyote %>% mutate(pet = recode_factor(pet, "Tamed Coyote" = NA_character_)) %>% 
  mutate(pet = recode_factor(pet, "Two" = NA_character_)) %>% 
  mutate(pet = recode_factor(pet, "I have 9 indoor pets of various sizes and species" = NA_character_))%>% 
  mutate(pet = recode_factor(pet, "All indoors and never unattended" = NA_character_))

## Separate multiple selections
coyote <- coyote %>% 
  mutate(pet.outdoor.cat = ifelse(str_detect(pet,"(?i)Outdoor.*Cat"),1,0),
         pet.small.dog = ifelse(str_detect(pet,"(?i)Small.*dog"),1,0),
         pet.lrg.dog = ifelse(str_detect(pet,"Large.*dog"),1,0))
         
## Look at data
coyote %>% 
  pivot_longer(pet.outdoor.cat:pet.lrg.dog, names_to="index",values_to="value") %>% 
  filter(value == 1) %>% 
  ggplot(aes(x = index, fill = index)) + 
  geom_bar() + 
  labs(x = "Pet Ownership", y = "Counts", title = "Pet Ownership") + 
  theme_minimal() + 
  theme(legend.position="none",
        axis.text.x = element_text(angle = 45, hjust = 1),
        text = element_text(family = "LM Roman 10 Bold", size=15))


## recategroize 'other' text
levels(coyote$pet.text)
view = coyote %>% select(pet, pet.text)

coyote <- coyote %>% 
  mutate(pet = as.character(pet)) 
class(coyote$pet)

coyote <- coyote %>% 
  mutate(pet.text = as.character(pet.text)) 
class(coyote$pet.text)

coyote <- coyote %>% 
  mutate(pet.text = case_when(pet.text %in% c("2 cats","cats (indoor only)",
                                              "i am active in cat rescue and have previously had outdoor feral cats. I moved them indoors.", 
                                              "Lost a cat to coyotes now indoor only") ~ "indoor cat",
                              pet.text %in% c("2 dogs","my dog is 45#, which I consider medium sized.") ~ "large dogs",
                              pet.text %in% c("3cats, 1. Corgi") ~ "outdoor cat, Corgi",
                              pet.text %in% c("cat goes out only if I am in yard") | str_detect(pet.text,"(?i)indoor/outdoor|cat.*night") ~ "int/out cat",
                              TRUE ~ pet.text)) %>% 
  mutate(pet.indoor.cat = ifelse(str_detect(pet.text,"(?i)indoor.*cat|house.*cat|door.*cat|indoor.*animal|inside.*cat"),1,0),
         #pet.indoor.outdoor.cat = ifelse(str_detect(pet.text, "(?i)int/out.*cat"),1,0), # I'm just calling this outdoor
         pet.outdoor.cat = replace(pet.outdoor.cat,str_detect(pet.text,"(?i)outdoor.*cat|stray.*cat|out.*cat"),1),
         pet.small.dog = replace(pet.small.dog,str_detect(pet.text,"(?i)Corgi|small.*dog"),1),
         pet.lrg.dog = replace(pet.lrg.dog,str_detect(pet.text,"(?i)lab|Medium-sized.*dog|lbdog|Border|large.*dog"),1),
         pet.bird = ifelse(str_detect(pet.text, "(?i)bird|macaw|parrot|cockatoo"),1,0),
         pet.rabbit = ifelse(str_detect(pet.text, "(?i)\\brabbit\\b|house.*rabbit|bunny|indoor.*rabbits"),1,0),
         pet.reptile = ifelse(str_detect(pet.text, "(?i)reptile|snake|herp|lizard|tortoise|turtle"),1,0),
         pet.ferret = ifelse(str_detect(pet.text, "(?i)ferret"),1,0), 
         pet.rodent = ifelse(str_detect(pet.text, "(?i)gerbil|guinea.*pig|hamter"),1,0)) 

##Lets plot pet type ownership distribution
levels <- coyote %>% 
  pivot_longer(pet.outdoor.cat:pet.bird, names_to="index",values_to="value") %>% 
  filter(value == 1) %>% 
  group_by(index) %>% 
  summarize(count=n()) %>% 
  arrange(count) %>% 
  select(index) %>% 
  as_vector()

coyote %>% 
  pivot_longer(pet.outdoor.cat:pet.bird, names_to="index",values_to="value") %>% 
  mutate(index = factor(index, levels = levels)) %>% 
  filter(value == 1) %>% 
  ggplot(aes(x = index, fill = index)) + 
  geom_bar() + 
  labs(x = "Pet Ownership", y = "Counts", title = "Pet Ownership") + 
  theme_minimal() + 
  theme(legend.position="none",
        axis.text.x = element_text(angle = 45, hjust = 1),
        text = element_text(family = "LM Roman 10 Bold", size=15)) 

# Livestock ownership-----------------------------------------------------------
## Let's start with ownership

ggplot(coyote, aes(x = livestock.owner, color = livestock)) +
  geom_bar(fill="white")

## Separate multiple selections
coyote <- coyote %>% 
  mutate(livestock.cattle = ifelse(str_detect(livestock,"(?i)cattle"),1,0),
         livestock.goat = ifelse(str_detect(livestock,"(?i)goat"),1,0),
         livestock.poultry = ifelse(str_detect(livestock,"(?i)poultry"),1,0),
         livestock.pig = ifelse(str_detect(livestock,"(?i)pig"),1,0),
         livestock.sheep = ifelse(str_detect(livestock,"(?i)sheep"),1,0))

## Look at data
coyote %>% 
  pivot_longer(livestock.cattle:livestock.sheep, names_to="index",values_to="value") %>% 
  filter(value == 1) %>% 
  ggplot(aes(x = index, fill = index)) + 
  geom_bar() + 
  labs(x = "Livestock Ownership", y = "Counts", title = "Livestock Ownership") + 
  theme_minimal() + 
  theme(legend.position="none",
        axis.text.x = element_text(angle = 45, hjust = 1),
        text = element_text(family = "sans", size=15))

## recategroize 'other' text

coyote <- coyote %>% 
  mutate(livestock.bee = ifelse(str_detect(livestock.text, "(?i)bees"),1,0),
         livestock.camelid = ifelse(str_detect(livestock.text, "(?i)llama|alpaca"),1,0),
         livestock.poultry = replace(livestock.poultry,str_detect(livestock.text,"(?i)peacock|hen"),1),
         livestock.equine = ifelse(str_detect(livestock.text,"(?i)horse|donkey"),1,0),
         livestock.cattle = replace(livestock.cattle,str_detect(livestock.text,"(?i)cattle|goat"),1),
         livestock.shellfish = ifelse(str_detect(livestock.text, "(?i)quoahogs"),1,0),
         livestock.rabbit = ifelse(str_detect(livestock.text, "(?i)outdoor.*rabbits|rabbits"),1,0))

levels <- coyote %>% 
  pivot_longer(livestock.cattle:livestock.shellfish, names_to="index",values_to="value") %>% 
  filter(value == 1) %>% 
  group_by(index) %>% 
  summarize(count=n()) %>% 
  arrange(count) %>% 
  select(index) %>% 
  as_vector()

coyote %>% 
  pivot_longer(livestock.cattle:livestock.shellfish, names_to="index",values_to="value") %>% 
  mutate(index = factor(index, levels = levels)) %>% 
  filter(value == 1) %>% 
  ggplot(aes(x = index, fill = index)) + 
  geom_bar() + 
  labs(x = "Livestock Ownership", y = "Counts", title = "Livestock Ownership") + 
  theme_minimal() + 
  theme(legend.position="none",
        axis.text.x = element_text(angle = 45, hjust = 1),
        text = element_text(family = "LM Roman 10 Bold", size=15)) 


# Lets get into the interactions now!------------------------------------------

# Pet-Coyote Interactions-------------------------------------------------------
## Create new column for having had any pet-coyote interaction
coyote = coyote %>% 
  mutate(coyote,
    pet.owner = if_else(pet.owner == "Yes", 1, 0)) 

pet.int = coyote %>% 
  select(c(matches("risk.|encounter.|attack.|missing.|kill."))) %>%
  select(-c(1:2, 23:length(.))) %>%
  mutate_all(~case_when(
    . == "Yes" ~ 1,
    . == "No" ~ 0))

pet.int = coyote %>%
  select(c(matches("risk.|encounter.|attack.|missing.|kill."))) %>%
  select(-c(1:2, 23:length(.)))

# Change pet.int from yes/no, to 1/0
pet.int = pet.int %>%
  mutate_all(~case_when(
    . == "Yes" ~ 1,
    . == "No" ~ 0))

## Create new column of all perceived pet-coyote int
pet.int.perc = pet.int %>%
  select(c(matches("risk.|missing.")))

## Turn column in 1/0 if perceived pet-coyote int occured (1 = Yes, 0 = NA or No)--This will be a later problem, I want NA's to stay NA's***
pet.int.perc = pet.int.perc %>% 
  mutate(pet.int.perc = ifelse(rowSums(pet.int.perc, na.rm=TRUE) >= 1, 1, 0)) %>%
  select(pet.int.perc)

## Create new column of all low pet-coyote int
pet.int.low = pet.int %>%
  select(matches("encounter.")) 

pet.int.low = pet.int.low %>% 
  mutate(pet.int.low = ifelse(rowSums(pet.int.low, na.rm=TRUE) >= 1, 1, 0)) %>%
  select(pet.int.low)

## Create new column of all high pet-coyote int and keep in coyote dataset
#We want to add this column to the coyote dataset so we can use this as an indp variable
pet.int.high = pet.int.high %>% 
  mutate(pet.int.high = ifelse(rowSums(pet.int.high, na.rm=TRUE) >= 1, 1, 0)) %>%
  select(pet.int.high)

animal.incident = coyote %>%
  select(c(matches("attack.|kill."), ID)) %>%
  mutate_if(sapply(., is.factor), as.character)
         
animal.incident = animal.incident %>%
  mutate_at(c("attack.outdoor.cat", "kill.outdoor.cat", "attack.large.dog", "kill.large.dog", "attack.small.dog",
              "kill.small.dog", "attack.pet", "kill.pet", "attack.goat", "kill.goat", "kill.sheep", "attack.sheep",
              "attack.poultry", "kill.poultry", "attack.pig", "kill.pig", "attack.cattle", "kill.cattle", 
              "kill.other", "attack.other"), 
  ~case_when(
    . == "Yes" ~ 1,
    . == "No" ~ 0))

animal.incident = animal.incident %>% 
  mutate(animal.incident = ifelse(rowSums(.[,1:20], na.rm=TRUE) >= 1, 1, 0)) %>%
  select(animal.incident, ID)

coyote = left_join(coyote, animal.incident, by = "ID")


## Now let's deal with livestock-coyote interactions----------------------------
coyote = coyote %>% 
  mutate(coyote,
         livestock.owner = if_else(livestock.owner == "Yes", 1, 0)) 


livestock.int = coyote %>%
  select(matches("risk.|encounter.|attack.|missing.|kill.")) %>%
  select(-c(1:22))

# Change livestock.int from yes/no, to 1/0
livestock.int = livestock.int %>%
  mutate_all(~case_when(
    . == "Yes" ~ 1,
    . == "No" ~ 0))
          
## Create new column of all percieved livestock-coyote int
livestock.int.perc = livestock.int %>%
  select(matches("risk.|missing.")) 

## Turn column in 1/0 if perceived livestock-coyote int occurred (1 = Yes, 0 = NA or No)--This will be a later problem, I want NA's to stay NA's***
livestock.int.perc = livestock.int.perc %>% 
  mutate(livestock.int.perc = ifelse(rowSums(livestock.int.perc, na.rm=TRUE) >= 1, 1, 0)) %>%
  select(livestock.int.perc)
         
## Create new column of all low livestock-coyote int
livestock.int.low = livestock.int %>%
  select(matches("encounter.")) 
## Turn column in 1/0 if low int of livestock-coyote occurred 
livestock.int.low = livestock.int.low %>% 
  mutate(livestock.int.low = ifelse(rowSums(livestock.int.low, na.rm=TRUE) >= 1, 1, 0)) %>%
  select(livestock.int.low)

## Create new column of all high livestock-coyote int
livestock.int.high = livestock.int %>%
  select(matches("attack.|kill.")) 
## Turn column in 1/0 if high int of livestock-coyote occurred 
livestock.int.high = livestock.int.high %>% 
  mutate(livestock.int.high = ifelse(rowSums(livestock.int.high, na.rm=TRUE) >= 1, 1, 0)) %>%
  select(livestock.int.high)

# We will also create a column for animal ownership (either own pets or livestock or both)
animal.owner = coyote %>% select(ID, pet.owner, livestock.owner) %>% 
  mutate(animal.owner = ifelse(pet.owner == 1 | livestock.owner ==1, 1, 0)) %>%
  select(-c(pet.owner, livestock.owner))

coyote = left_join(coyote, animal.owner, by = "ID")

animal.owner.animal = coyote %>% select(ID, pet.owner, livestock.owner, pet, pet.text, livestock, livestock.text) %>% 
  mutate(animal.owner = ifelse(pet.owner == 1 | livestock.owner ==1, 1, 0)) %>%
  select(-c(pet.owner, livestock.owner))

# Now we consider our response variables----------------------------------------
# First Value of coyotes
# Lets focus on Peoples Thoughts on coyotes, e.g. ranking of benefits and risks-

## Starting with benefits strong disagree [1] -> strong agree [5]---------------
coyote <- coyote  %>%
  mutate(important.ecosystem = fct_relevel(important.ecosystem, c("Strongly Disagree", "Disagree", "Neither agree nor disagree",  "Agree", "Strongly Agree")))
coyote <- coyote  %>%
  mutate(beneficial.humans = fct_relevel(beneficial.humans, c("Strongly Disagree", "Disagree", "Neither agree nor disagree",  "Agree", "Strongly Agree")))
coyote <- coyote  %>%
  mutate(beneficial.wildlife = fct_relevel(beneficial.wildlife, c("Strongly Disagree", "Disagree", "Neither agree nor disagree",  "Agree", "Strongly Agree")))
coyote <- coyote  %>%
  mutate(important.hunters = fct_relevel(important.hunters, c("Strongly Disagree", "Disagree", "Neither agree nor disagree",  "Agree", "Strongly Agree")))

## Now risks strong disagree [5] -> strongly agree [1]--------------------------
coyote <- coyote  %>%
  mutate(risk.humans = fct_relevel(risk.humans, c("Strongly Agree", "Agree", "Neither agree nor disagree", "Disagree", "Strongly disagree")))
coyote <- coyote  %>%
  mutate(risk.pets = fct_relevel(risk.pets, c("Strongly Agree", "Agree", "Neither agree nor disagree",  "Disagree", "Strongly disagree")))
coyote <- coyote  %>%
  mutate(negative.wildlife = fct_relevel(negative.wildlife, c("Strongly Agree", "Agree", "Neither agree nor disagree",  "Disagree", "Strongly disagree")))
coyote <- coyote  %>%
  mutate(diseases = fct_relevel(diseases, c("Strongly Agree", "Agree", "Neither agree nor disagree",  "Disagree", "Strongly disagree")))

# These are now leveled so that the higher the level number, the more value ppl
# have of coyotes


# Lets check out fear and relevel------------------------------------------------------------------------------

coyote <- coyote  %>%
  mutate(fearful = fct_relevel(fearful, c("Strongly disagree", "Disagree", "Neither agree nor disagree",  "Agree", "Strongly Agree")))

plot(coyote$fearful)
# How does fear influence various aspects of how people view coyotes?
# first let's bin those who 'agree' and those who 'disagree'
fear <- coyote %>%
  select(fearful, ID) %>%
  mutate(fear = case_when(
    fearful == "Strongly disagree" ~ 0,
    fearful == "Disagree" ~ 0,
    fearful == "Agree" ~ 1,
    fearful == "Strongly Agree" ~ 1)) %>% select(-fearful)

coyote = left_join(coyote, fear, by = "ID") #Remember you need to join on a unique variable

# Population of Coyotes----------------------------------------------------------------------------------------
# View on coyote population, these levels are not necessarily representative but we can focus on different levels for different questions
coyote <- coyote  %>%
  mutate(coyote.population = fct_relevel(coyote.population, c("Too many", "Just right", "I do not have an opinion",  "I do not know", "Too few")))

# Knowledge of Coyotes-----------------------------------------------------------------------------------------
# Lets score participants by summing the correct reponses to questions about coyotes
# First lets tell R whats correctly true and false 
coyote = coyote %>% mutate(native = ifelse(str_detect(native,"TRUE"),1,0)) # Correct answer is TRUE
coyote = coyote %>% mutate(ri.past.10.years = ifelse(str_detect(ri.past.10.years,"FALSE"),1,0)) # Correct answer is FALSE
coyote = coyote %>% mutate(litter.food = ifelse(str_detect(litter.food,"TRUE"),1,0)) # Correct answer is TRUE
coyote = coyote %>% mutate(nocturnal = ifelse(str_detect(nocturnal,"FALSE"),1,0)) # Correct answer is FALSE
coyote = coyote %>% mutate(carnivores = ifelse(str_detect(carnivores,"FALSE"),1,0)) # Correct answer is FALSE
coyote = coyote %>% mutate(human.rabies.year = ifelse(str_detect(human.rabies.year,"FALSE"),1,0)) # Correct answer is FALSE
coyote = coyote %>% mutate(furbearers = ifelse(str_detect(furbearers,"TRUE"),1,0)) # Correct answer is TRUE

match("native", names(coyote)) #44
match("furbearers", names(coyote)) #50

# This is a bit tricky as a majority of people skipped at least some knowledge questions. If we remove anyone with NA's
# we will have very little data. I presume that the majority of participants who skippd questions did not know the answer
# I also wonder if there was an error with the survey because I don't see any 'I don't know's in the raw data.
# I will say that if all columns are NA, it is a true NA and if some are NA, they are really "I don't knows'
knowledge.score = coyote %>% select(native:furbearers, ID) %>% 
  mutate(all.na = ifelse(rowSums(is.na(.[,1:7])) == 7,TRUE,FALSE)) %>%
  filter(., all.na == FALSE) %>%
  select(-all.na) 

# lets convert, those who answered true/false to some and NA to some will go from NA to 0
knowledge.score = knowledge.score %>% replace_na(list(native = 0, ri.past.10.years = 0, litter.food = 0, nocturnal = 0, carnivores = 0, human.rabies.year = 0, furbearers = 0))

# trying to summarize specific columns by for all rows in certain column names
knowledge.score = knowledge.score %>% mutate(knowledge.score = rowSums(.[,1:7], na.rm = TRUE)) %>% select(-c(native:furbearers))

coyote = left_join(coyote, knowledge.score, by = "ID")
exam = coyote %>% select(native:furbearers, ID, knowledge.score) # check this worked

# Let's save our data set and start analyzing data elsewhere!-------------------

write.csv(coyote, file = "OUTPUT LOCATION/FILE HERE")


########################   STOP HERE FOR CLEANING   ############################

## Prep data for bayesian analysis on coyote 'value'----------------------------
# this is a Likert scale so we need one more step to analyze data

coyote.values.bays = coyote %>%
  select(c(important.ecosystem, beneficial.humans, beneficial.wildlife, important.hunters,
           risk.humans, risk.pets, negative.wildlife, diseases, ID)) %>%
  mutate_at(c("important.ecosystem", "beneficial.humans", "beneficial.wildlife", "important.hunters",
              "risk.humans", "risk.pets", "negative.wildlife", "diseases"), ~unclass(.))


coyote.values.bays = coyote.values.bays %>% pivot_longer(cols = important.ecosystem:diseases,
                                                         names_to = "value_question",
                                                         values_to = "value_rate")

# Intercepts refer to the rating with rating 5 being the reference category
coyote_bayes = inner_join(coyote, coyote.values.bays, by = "ID") #Remember you need to join on a unique variable


## Save tables needed for Bayes analyses----------------------------------------
save(coyote, file="coyote")
save(coyote_bayes, file="coyote_bayes")